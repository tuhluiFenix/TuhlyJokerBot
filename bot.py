#  –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Python (–±–∞–∑–æ–≤—ã–µ)
import os  # "–ö–ª—é—á–∏ –æ—Ç –≤—Å–µ—Ö –¥–≤–µ—Ä–µ–π" - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
import logging  # "–î–Ω–µ–≤–Ω–∏–∫ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞" - –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫

#  –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
import praw  # "–ì–ª–∞–∑ –°–∞—É—Ä–æ–Ω–∞" - –¥–ª—è —Å–ª–µ–∂–∫–∏ –∑–∞ –º–µ–º–∞–º–∏ –≤ Reddit
from dotenv import load_dotenv  # "–°—É–Ω–¥—É–∫ –ü–∞–Ω–¥–æ—Ä—ã" - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π

# –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Telegram-–±–æ—Ç–∞
from telegram import (
    Update,  # "–ö–∞–º–µ–Ω—å —è—Å–Ω–æ–≤–∏–¥–µ–Ω–∏—è" - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ReplyKeyboardMarkup  # "–†—É–Ω–∏—á–µ—Å–∫–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞" - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ –º–µ–Ω—é
)

from telegram.ext import (
    Application,  # "–ö–æ—Ç–µ–ª –≤–∞—Ä–≤–∞—Ä–∞" - –≥–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫ –±–æ—Ç–∞
    CommandHandler,  # "–ü–æ—Å–æ—Ö –∫–æ–º–∞–Ω–¥" - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ —Ç–∏–ø–∞ /start
    MessageHandler,  # "–ó–µ—Ä–∫–∞–ª–æ –¥—É—à–∏" - —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    filters,  # "–°–∏—Ç–æ –•–∞–æ—Å–∞" - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    ContextTypes  # "–°—É–º–∫–∞ –∞–ª—Ö–∏–º–∏–∫–∞" - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥—Ä–µ–≤–Ω–∏—Ö —Ä—É–Ω (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è)
load_dotenv()  # –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª .env, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ä–æ—á–µ—Å–∫–æ–≥–æ —Å–≤–∏—Ç–∫–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
logging.basicConfig(
    format='%(asctime)s - '  # –í—Ä–µ–º—è –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —Ä–∏—Ç—É–∞–ª–∞
    '%(name)s - '            # –ò–º—è –∑–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—è (–º–æ–¥—É–ª—è)
    '%(levelname)s - '       # –£—Ä–æ–≤–µ–Ω—å —É–≥—Ä–æ–∑—ã (INFO/ERROR)
    '%(message)s',           # –¢–µ–∫—Å—Ç –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞
    level=logging.INFO       # –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (INFO –∏ –≤—ã—à–µ)
)

#  –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–∞–∫—É–ª–∞ (–ª–æ–≥–≥–µ—Ä–∞)
logger = logging.getLogger(__name__)  # __name__ = "–∏–º—è —Ç–µ–∫—É—â–µ–≥–æ –º–æ–¥—É–ª—è"

#  –ü–æ–∏—Å–∫ —É—Ç–µ—Ä—è–Ω–Ω—ã—Ö —Ä–µ–ª–∏–∫–≤–∏–π (–∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
REDDIT_CLIENT_ID = os.getenv("REDDIT_CLIENT_ID")  # –ö–ª—é—á –æ—Ç –í—Ä–∞—Ç –ú–µ–º–æ—Ä–∏–ª–æ–Ω–∞
REDDIT_SECRET = os.getenv("REDDIT_SECRET")       # –°–µ–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–∏–∫—Å–∏—Ä –°–∞–±—Ä–µ–¥–¥–∏—Ç—Å–∫–æ–≥–æ –ê–ª—Ö–∏–º–∏–∫–∞
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")     # –ü–µ—Ä–æ –§–µ–Ω–∏–∫—Å-–ö—É—Ä—å–µ—Ä–∞

# –†–∏—Ç—É–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
if not all([REDDIT_CLIENT_ID, REDDIT_SECRET, TELEGRAM_TOKEN]):
    # –°–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫–ª—è—Ç—ã—Ö (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö) –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    missing = [name for name, value in zip(
        ["REDDIT_CLIENT_ID", "REDDIT_SECRET", "TELEGRAM_TOKEN"],  # –ò–º–µ–Ω–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
        [REDDIT_CLIENT_ID, REDDIT_SECRET, TELEGRAM_TOKEN]         # –ò—Ö –≤–æ–ø–ª–æ—â–µ–Ω–∏—è –≤ –Ω–∞—à–µ–º –º–∏—Ä–µ
    ) if not value]  # –ò—â–µ–º –ø—É—Å—Ç—ã–µ —Å–æ—Å—É–¥—ã

    # –í—ã–∑—ã–≤–∞–µ–º –¥—É—Ö–æ–≤ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
    raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: {', '.join(missing)}")

#  –°–æ–∑–¥–∞–µ–º "–¢—Ä–æ–Ω –∏–∑ –ö–æ—Å—Ç–µ–π –ú–µ–º–æ–≤" (–∫–ª–∏–µ–Ω—Ç Reddit)
reddit = praw.Reddit(
    client_id=REDDIT_CLIENT_ID,       # –ö–ª—é—á –æ—Ç –°–∫–ª–µ–ø–∞ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏—Ö –®—É—Ç–æ–∫
    client_secret=REDDIT_SECRET,      # –§–ª–∞–∫–æ–Ω —Å –ö—Ä–æ–≤—å—é –°–∞—Ç–∏—Ä—ã
    user_agent="TuhlyJokerBot:1.0 "  # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–µ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ
    "(by /u/Beneficial-Prize-383, "  # –ò–º—è –î—É—Ö–∞-–ü–æ–∫—Ä–æ–≤–∏—Ç–µ–ª—è
    "https://github.com/tuhluiFenix)"  # –°—Å—ã–ª–∫–∞ –Ω–∞ –ö–Ω–∏–≥—É –¢–µ–Ω–µ–π
)

sent_memes = set()

#  –°–æ–∑–¥–∞–µ–º "–î–æ—Å–∫—É –ü—Ä–æ–∫–ª—è—Ç–∏–π" (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ–Ω—é)
MAIN_KEYBOARD = ReplyKeyboardMarkup(
    keyboard=[
        # –ü–µ—Ä–≤—ã–π —Ä—è–¥ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
        ["–ì—Ä—É—Å—Ç—å üò¢", "–†–∞–¥–æ—Å—Ç—å üòä"],  

        # –í—Ç–æ—Ä–æ–π —Ä—è–¥ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
        ["–ö–æ–¥ üíª", "–ü—Ä–æ–∫–ª—è—Ç—å–µ üíÄ"]
    ],
    resize_keyboard=True,  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —ç–∫—Ä–∞–Ω
    input_field_placeholder="–°–¥–µ–ª–∞–π —Å–≤–æ–π –≤—ã–±–æ—Ä, —Å–º–µ—Ä—Ç–Ω—ã–π..."  # –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å–º–µ—Ä—Ç–Ω—ã—Ö
)


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–†–∏—Ç—É–∞–ª –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
    await update.message.reply_text(
        text="*–í—ã–±–µ—Ä–∏ –ø—É—Ç—å, –ø—É—Ç–Ω–∏–∫:*",
        reply_markup=MAIN_KEYBOARD,
        parse_mode="Markdown"
    )


async def handle_buttons(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–æ –≥–ª–∞—Å–∏—Ç: –∫–æ–≥–¥–∞ —Å–º–µ—Ä—Ç–Ω—ã–π –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É..."""
    # –ß–∏—Ç–∞–µ–º —Å—É–¥—å–±—É (—Ç–µ–∫—Å—Ç –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏)
    button_text = update.message.text

    # –ö–Ω–∏–≥–∞ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–Ω–æ–ø–æ–∫ –∏ –æ—Ç–≤–µ—Ç–æ–≤)
    responses = {
        # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –§–µ–Ω–∏–∫—Å–∞
        "–ì—Ä—É—Å—Ç—å üò¢": "–ü–µ–ø–µ–ª –±—ã–ª—ã—Ö –º–µ–º–æ–≤ —Å–∫–æ—Ä–æ —è–≤–∏—Ç—Å—è... üò¢",
        "–†–∞–¥–æ—Å—Ç—å üòä": "–í—Å–ø–æ–ª–æ—Ö–∏ —Ä–∞–¥–æ—Å—Ç–∏ —É–∂–µ –Ω–∞ –ø–æ–¥—Ö–æ–¥–µ! ‚ú®",

        # –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
        "–ö–æ–¥ üíª": "**–ö—Ä—è—Ö—Ç—è—â–∏–π –º–µ–º –ø—Ä–æ –∫–æ–¥:**\n`–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –≤–æ—Å—Å—Ç–∞–Ω–∏–µ...` üíª",
        "–ü—Ä–æ–∫–ª—è—Ç—å–µ üíÄ": "–¢—å–º–∞ —Å–≥—É—â–∞–µ—Ç—Å—è... –∂–¥–∏ –º–µ–º–æ–≤ –ø–æ—Å–ª–µ –ø–æ–ª—É–Ω–æ—á–∏ üïØÔ∏è"
    }

    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–æ –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
    response = responses.get(
        button_text,
        "‚ö†Ô∏è *–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ!*\n–ò—Å–ø–æ–ª—å–∑—É–π —Ä—É–Ω—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤ –º–∏—Ä —Å–º–µ—Ä—Ç–Ω—ã—Ö
    await update.message.reply_text(
        text=response,
        parse_mode="Markdown"  # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    )


def main():
    """–ì–ª–∞–≤–Ω—ã–π –†–∏—Ç—É–∞–ª –ü—Ä–∏–∑—ã–≤–∞–Ω–∏—è –ë–æ—Ç–∞-–§–µ–Ω–∏–∫—Å–∞"""

    # –°—Ç—Ä–æ–∏–º –¢–µ–ª–æ –ë–æ—Ç–∞ –∏–∑ –ö–æ—Å–º–∏—á–µ—Å–∫–æ–π –ü—ã–ª–∏
    app = Application.builder().token(TELEGRAM_TOKEN).build()

    # –ù–∞–≤–µ—à–∏–≤–∞–µ–º –ó–∞—â–∏—Ç–Ω—ã–µ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è (—Ö–µ–Ω–¥–ª–µ—Ä—ã):
    app.add_handlers([
        # 1. –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ /start (–∏–Ω–∏—Ü–∏–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∞–¥–µ–ø—Ç–∞)
        CommandHandler("start", start),

        # 2. –õ–æ–≤—É—à–∫–∞ –¥–ª—è –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ (—Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –ù–ï-–∫–æ–º–∞–Ω–¥)
        MessageHandler(filters.TEXT & ~filters.COMMAND, handle_buttons)
    ])

    # –ó–∞–ø–∏—Å—å –≤ –ö–Ω–∏–≥—É –°—É–¥–µ–± (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
    logger.info("–ü—Ä–æ–≤–µ—Ä—è—é —Å–≤—è–∑—å —Å –ö—Ä–∞—Å–Ω—ã–º –ê–ª—Ç–∞—Ä–µ–º (Reddit API)...")
    try:
        reddit.user.me()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Reddit
    except Exception as e:
        logger.critical(f"–ö—Ä–∞—Å–Ω—ã–π –ê–ª—Ç–∞—Ä—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: {e}")
        raise

    # –ó–∞–ø—É—Å–∫–∞–µ–º –í–µ—á–Ω—ã–π –¶–∏–∫–ª –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
    app.run_polling(
        poll_interval=0.1,  # –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        timeout=10         # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram
    )


if __name__ == "__main__":
    """–¢–æ—á–∫–∞ –í—Ö–æ–¥–∞ –≤ –ü—Ä–æ–∫–ª—è—Ç—ã–π –ú–∏—Ä"""
    main()  # –ò—Å–ø–æ–ª–Ω—è–µ–º –†–∏—Ç—É–∞–ª –ü—Ä–∏–∑—ã–≤–∞–Ω–∏—è
